%================================================================================
\subsection{FCT}
%================================================================================
%================================================================================
\subsubsection{The Steady-State System}
%================================================================================
Without strongly imposing Dirichlet boundary conditions, the high-order system is
\begin{equation}\label{ss_high}
   \mathbf{A}^H\mathbf{U}^H = (\mathbf{K}^H + \mathbf{R}^H)\mathbf{U}^H = \mathbf{b},
\end{equation}
and the corresponding low-order system is
\begin{equation}\label{ss_low}
   \mathbf{A}^L\mathbf{U}^L = (\mathbf{K}^H - \mathbf{D} + \mathbf{R}^L)\mathbf{U}^L = \mathbf{b},
\end{equation}

After strongly imposing Dirichlet boundary conditions, the linear
systems given by Equations \ref{ss_high} and \ref{ss_low} are modified:
\begin{equation}\label{ss_highD}
   \tilde{\mathbf{A}}^H\mathbf{U}^H = \tilde{\mathbf{b}},
\end{equation}
\begin{equation}\label{ss_lowD}
   \tilde{\mathbf{A}}^L\mathbf{U}^L = \tilde{\mathbf{b}}.
\end{equation}
Specifically, matrix rows corresponding to degrees of freedom subject to Dirichlet
boundary conditions, say $i$, are modified to represent the equation
$U_i = g_i$, where $g_i$ is the Dirichlet value, so for the linear system
$\mathbf{A}\mathbf{U}=\mathbf{b}$, row $i$ of the system becomes
\[
   A_{i,i} = c, \qquad A_{i,j} = 0, \quad\forall j\ne i, \qquad b_i = c g_i,
      \qquad i\in \mathcal{D}
\]
where $c$ is an arbitrary constant, usually taken to be 1, and $\mathcal{D}$ is the set
of degrees of freedom indices subject to Dirichlet boundary conditions.
%--------------------------------------------------------------------------------
\subsubsection{Flux Correction Algorithm}
%--------------------------------------------------------------------------------
The flux correction vector $\mathbf{f}$ is defined such that:
\begin{equation}\label{ss_kuzminfc}
   \mathbf{A}^L\mathbf{U}^H = (\mathbf{K}^H - \mathbf{D} + \mathbf{R}^L)\mathbf{U}^H = \mathbf{b} + \mathbf{f} \equiv \mathbf{b}^F,
\end{equation}
Subtracting Equation \ref{ss_high} from \ref{ss_kuzminfc} gives the definition of
$\mathbf{f}$:
\begin{equation}\label{ss_kuzminFdef}
   \mathbf{f} \equiv -\mathbf{C}\mathbf{U}^H,
\end{equation}
where
\begin{equation}
   \mathbf{C}\equiv \mathbf{D} + \mathbf{R}^H - \mathbf{R}^L.
\end{equation}
Since $\mathbf{C}$ is symmetric
and features zero row and column sums, a valid decomposition for $\mathbf{f}$,
called $\mathbf{F}$, is
\begin{equation}
   F_{i,j} = C_{i,j}(U^H_i - U^H_j).
\end{equation}
Applying a limiter to Equation \ref{ss_kuzminfc} gives
\begin{equation}\label{ss_limited}
   \mathbf{A}^L\mathbf{U}^F = \mathbf{b} + \mathcal{L}[\mathbf{F}],
\end{equation}
where $(\mathcal{L}[\mathbf{F}])_i = \mathcal{L}_{i,:}F_{i,:}^T
= \sum\limits_j \mathcal{L}_{i,j}F_{i,j}$ and $\mathbf{U}^F$ is the FCT solution.

\begin{lemma}
   Suppose that with strongly imposed Dirichlet boundary conditions, the
   correction step is defined such that the Dirichlet boundary conditions
   are strongly imposed on Equation \ref{ss_kuzminfc}:
   \begin{equation}\label{ss_kuzminfcD}
      \tilde{\mathbf{A}}^L\hat{\mathbf{U}}^H
         = \tilde{\mathbf{b}}^F,
   \end{equation}
   and the definition for
   the flux correction vector $\mathbf{f}$ from
   Equation \ref{ss_kuzminFdef} is used without modification. Then the solution
   to this correction step, $\hat{\mathbf{U}}^H$, will yield the
   correct high-order solution $\mathbf{U}^H$ given by Equation \ref{ss_highD}.
\end{lemma}
\begin{proof}
   For $i\in\mathcal{D}$, $\hat{U}^H_i = U^H_i = g_i$. For $i\notin\mathcal{D}$,
   we take the $i$th equation of the linear system given by Equation \ref{ss_kuzminfcD}:
   \begin{equation}\label{ss_i_eq}
      (\mathbf{A}^L\hat{\mathbf{U}}^H)_i = b_i - (\mathbf{D}\mathbf{U}^H)_i.
   \end{equation}
   Examining the $i$th equation of the linear system given by Equation \ref{ss_highD}
   and solving for $b_i$ gives
   \begin{equation}
      b_i = (\mathbf{A}^H\mathbf{U}^H)_i.
   \end{equation}
   Substituting this back into Equation \ref{ss_i_eq} gives
   \begin{eqnarray}
      (\mathbf{A}^L\hat{\mathbf{U}}^H)_i & = & (\mathbf{A}^H\mathbf{U}^H)_i - (\mathbf{D}\mathbf{U}^H)_i,\\
      (\mathbf{A}^L\hat{\mathbf{U}}^H)_i & = & (\mathbf{A}^L\mathbf{U}^H)_i.
   \end{eqnarray}
   The system of equations
   \begin{equation}
      \left\{
         \begin{array}{l l}
            \hat{U}^H_i = U^H_i & i\in\mathcal{D}\\
            (\mathbf{A}^L\hat{\mathbf{U}}^H)_i = (\mathbf{A}^L\mathbf{U}^H)_i
               & i\notin\mathcal{D}
         \end{array}
      \right.
   \end{equation}
   determines that $\hat{\mathbf{U}}^H$ is uniquely equal to $\mathbf{U}^H$.
   \qed
\end{proof}
%================================================================================
\subsubsection{Deriving the Limiting Coefficients}
%================================================================================
\begin{lemma}\label{ss_coef}
   The maximum principle
   \begin{equation}
      -\frac{1}{A^L_{i,i}}\sum\limits_{j\ne i} A^L_{i,j}
      U_{\min,i}
      + \frac{b_i}{A^L_{i,i}}
      \leq U_i\leq
      -\frac{1}{A^L_{i,i}}\sum\limits_{j\ne i} A^L_{i,j}
      U_{\max,i}
      + \frac{b_i}{A^L_{i,i}}\quad\forall i,
   \end{equation}
   is satisfied using the following definitions of limiting coefficients:
   \begin{equation}\label{P_defs}
      P_i^+ \equiv \sum\limits_j\max(0,F_{i,j}) \qquad
      P_i^- \equiv \sum\limits_j\min(0,F_{i,j}),
   \end{equation}
   \begin{equation}
      Q_i^\pm \equiv \sum\limits_{j\ne i}A_{i,j}^L(U_j - U_{\substack{\max\\\min},i}),
   \end{equation}
   \begin{equation}\label{R_defs}
      R_i^\pm \equiv\left\{
         \begin{array}{l l}
            1                                          & P_i^\pm = 0\\
            \min\left(1,\frac{Q_i^\pm}{P_i^\pm}\right) & P_i^\pm \ne 0
         \end{array}
         \right.,
   \end{equation}
   \begin{equation}\label{L_defs}
      \mathcal{L}_{i,j} \equiv\left\{
         \begin{array}{l l}
            \min(R_i^+,R_j^-) & F_{i,j} \geq 0\\
            \min(R_i^-,R_j^+) & F_{i,j} < 0
         \end{array}
         \right.,
   \end{equation}   
\end{lemma}

\begin{proof}
   First, note some properties of the above definitions:
   \begin{gather*}
      P_i^+ \geq 0, \qquad P_i^- \leq 0,\\
      Q_i^+ \geq 0, \qquad Q_i^- \leq 0,\\
      0 \leq R_i^\pm \leq 1,\\
      0 \leq \mathcal{L}_{i,j} \leq 1.
   \end{gather*}
   The proof will be given for the upper bound.
   \[
      \sum\limits_j \mathcal{L}_{i,j}F_{i,j}
         \leq \sum\limits_{j:F_{i,j}\geq 0} \mathcal{L}_{i,j}F_{i,j}
         = \sum\limits_{j:F_{i,j}\geq 0} \min(R_i^+,R_j^-)F_{i,j}
         \leq \sum\limits_{j:F_{i,j}\geq 0} R_i^+ F_{i,j}
   \]
   For the case $P_i^+ = 0$,
   \[
      \sum\limits_{j:F_{i,j}\geq 0} R_i^+ F_{i,j} = 0 \leq Q_i^+
   \]
   For the case $P_i^+ \ne 0$,
   \[
      \sum\limits_{j:F_{i,j}\geq 0} R_i^+ F_{i,j}
      \leq \sum\limits_{j:F_{i,j}\geq 0}\frac{Q_i^+}{P_i^+} F_{i,j}
      = \frac{Q_i^+}{P_i^+} \sum\limits_{j:F_{i,j}\geq 0} F_{i,j}
      = \frac{Q_i^+}{P_i^+} \sum\limits_{j:F_{i,j}\geq 0} \max(0,F_{i,j})
      = Q_i^+
   \]
   Thus,
   \[
      \sum\limits_j \mathcal{L}_{i,j}F_{i,j} \leq Q_i^+
   \]
   Taking row $i$ of the linear system given by Equation \ref{ss_limited} gives
   \begin{eqnarray*}
      A^L_{i,i} U_i + \sum\limits_{j\ne i} A_{i,j}^L U_j
         & = & \sum\limits_j \mathcal{L}_{i,j}F_{i,j} + b_i\\
         & \leq & Q_i^+ + b_i\\
         & \leq & \sum\limits_{j\ne i}A_{i,j}^L(U_j - U_{\max,i}) + b_i\\
      A^L_{i,i} U_i & \leq & -\sum\limits_{j\ne i} A_{i,j}^L U_{\max,i} + b_i\\
      U_i & \leq & -\frac{1}{A^L_{i,i}}\sum\limits_{j\ne i} A_{i,j}^L U_{\max,i}
         + \frac{b_i}{A^L_{i,i}}.
   \end{eqnarray*}
   The lower bound is proved similarly.
   \qed
\end{proof}