%================================================================================
\section{FCT Schemes}
%================================================================================
In this section, two FCT schemes are presented, which
differ in the low-order and high-order schemes used, and thus the
correction flux $\f$ and its decomposition $\F$.
The equations that follow, Equations \eqref{ex_kuzminfc} and
\eqref{ex_limited}, represent the FCT schemes in general, and
Sections \ref{algebraicFCT} and \ref{gtFCT} give the two FCT
schemes by completing the scheme given in Equation \eqref{ex_limited}
with the definition of $\F$. The limiter $\L$ is
defined in Section \ref{L}.

The flux correction vector $\f$ is defined such that:
\begin{equation}\label{ex_kuzminfc}
   \M_L\frac{\U^{H,n+1}-\U^n}{\dt} + \A^L\U^n = \b + \f.
\end{equation}
Decomposing the correction flux into $\F$ and applying a limiter
$\L$ gives
\begin{equation}\label{ex_limited}
   \M_L\frac{\U^{n+1}-\U^n}{\dt} + \A^L\U^n = \b + \LF \eqc
\end{equation}
where $(\LF)_i = L_{i,:}F_{i,:}^T
= \sum\limits_j L_{i,j}F_{i,j}$ and $\U^{n+1}$
is the FCT solution.

Both FCT schemes have the same expression for the discrete maximum principle (DMP)
that is imposed on the FCT solution, so to avoid duplication in the following
sections, the FCT DMP bounds are presented here:
%--------------------------------------------------------------------------------
\begin{definition}[label={FCTbounds}]{Maximum Principle Bounds Imposed on FCT Solution}
   The bounds to be imposed on the FCT solution are the upper bound of the
   continuous maximum principle, given by Equation \eqref{cont} and the
   lower bound of the discrete maximum principle, given by Equation
   \eqref{ex_bounds}:
   \begin{equation}\label{FCTupper}
      W_i^+\equiv U_{\max,i}^n e^{-c\Delta t\sigma_{\min,i}},
   \end{equation}
   \begin{equation}\label{FCTlower}
      W_i^-\equiv U_{\min,i}^n\left(1-\frac{\Delta t}{m_i}\sum\limits_j A^L_{i,j}\right)
      + \frac{\Delta t}{m_i}b_i.
   \end{equation}
\end{definition}
%--------------------------------------------------------------------------------
\begin{proposition}{Discrete $L^\infty$ Norm Stability}
   Schemes that satisfy the bounds given in Definition \ref{FCTbounds} are
   stable in the discrete $L^\infty$ norm.
\end{proposition}

\begin{proof}
   Let $k$ be the index corresponding to the degree of freedom for which
   the maximum discrete value is obtained, i.e.,
   \[
      U_k^{n+1}\equiv\max\limits_j U_j^{n+1}=\|\U^{n+1}\|_\infty.
   \]
   Starting with the upper bound given by Definition \ref{FCTbounds},
   \[
      \|\U^{n+1}\|_\infty = U_k^{n+1} \le
      U_{\max,k}^n e^{-c\Delta t\sigma_{\min,k}} \le
      U_{\max,k}^n \le
      \max\limits_j U_j^n = \|\U^{n}\|_\infty.
   \]
   Applying this inequality recursively shows that the solution is bounded
   by the initial data $\U^0$:
   \[
      \|\U^{n+1}\|_\infty\le
      \|\U^{n}\|_\infty\le
      \|\U^{n-1}\|_\infty\le\ldots\le
      \|\U^{0}\|_\infty.\qed
   \]
\end{proof}
%--------------------------------------------------------------------------------
\subsection{Algebraic FCT Scheme}\label{algebraicFCT}
%================================================================================
In this section, an FCT scheme is defined using the ``algebraic'' low-order
scheme, given in Section \ref{algebraicloworder}, in conjunction with the
Galerkin scheme, given in Section \ref{galerkindef}, which serves as the
high-order scheme. Combining Equations \eqref{galerkin_FE} and
\eqref{ex_kuzminfc} gives the definition of $\f$:
\begin{equation}\label{ex_kuzminFdef}
   \f \equiv -(\M_C-\M_L)\mathbf{\dot{U}}^{H,n+1}
      +\D\U^n,
\end{equation}
where $\mathbf{\dot{U}}^{H,n+1} \equiv (\U^{H,n+1} - \U^n)/\Delta t$.
Since $\M_C-\M_L$ and $\D$ are symmetric
and feature zero row and column sums, a valid decomposition for $\f$,
called $\F$, is
\begin{equation}
   F_{i,j} = -m_{i,j}(\dot{U}^{H,n+1}_j - \dot{U}^{H,n+1}_i)
   + D_{i,j}(U^n_j - U^n_i)
\end{equation}
where $m_{i,j}$ is the $i,j$th element of the consistent mass matrix.
%--------------------------------------------------------------------------------
\subsection{Graph-Theoretic FCT Scheme}\label{gtFCT}
%================================================================================
In this section, an FCT scheme is defined using the ``graph-theoretic'' low-order
scheme, given in Section \ref{gtloworder}, in conjunction with the
high-order scheme given in Section \ref{gthighorder}, which serves as the
high-order scheme. Combining Equations \eqref{gthighorderscheme} and
\eqref{ex_kuzminfc} gives the definition of $\f$:
\begin{equation}\label{gtf}
   \f \equiv -(\M_C-\M_L)\dot{\U}^{H,n+1} + (\D^L-\D^H)\U^n \eqc
\end{equation}
where $\dot{\U}^{H,n+1} \equiv (\U^{H,n+1} - \U^n)/\Delta t$.
Since $\M_C-\M_L$ and $\D^L-\D^H$ are symmetric
and feature zero row and column sums, a valid decomposition for $\f$,
called $\F$, is
\begin{equation}
   F_{i,j} = -m_{i,j}(\dot{U}^{H,n+1}_j - \dot{U}^{H,n+1}_i)
   + (D_{i,j}^L-D_{i,j}^H)(U^n_j - U^n_i),
\end{equation}
where $m_{i,j}$ is the $i,j$th element of the consistent mass matrix.
%--------------------------------------------------------------------------------
%\begin{lemma}{Implementation of Dirichlet Boundary Conditions}
   %Suppose that with strongly imposed Dirichlet boundary conditions, the
   %correction step is defined such that the Dirichlet boundary conditions
   %are strongly imposed on Equation \eqref{ex_kuzminfc}:
   %\begin{equation}\label{ex_kuzminfcD}
      %\tilde{\M}_L\hat{\U}^H
         %= \tilde{\b}^F,
   %\end{equation}
   %and the definition for
   %the flux correction vector $\f$ from
   %Equation \eqref{ex_kuzminFdef} is used without modification. Then the solution
   %to this correction step, $\hat{\U}^H$, will yield the
   %correct high-order solution $\U^H$ given by Equation \eqref{highD}.
%\end{lemma}
%\begin{proof}
   %For $i\in\mathcal{D}$, $\hat{U}^H_i = U^H_i = g_i$. For $i\notin\mathcal{D}$,
   %we take the $i$th equation of the linear system given by Equation \eqref{ex_kuzminfcD}:
   %\begin{equation}\label{ex_i_eq}
      %m_i\hat{U}^H_i
         %= m_i U^n_i - \Delta t((\mathbf{K}^H - \D + \mathbf{R}^L)\U^n)_i
         %+ \Delta t b_i - (\M_C\Delta\U^H)_i
         %+ m_i(U^H_i-U^n_i) - \Delta t(\D\U^n)_i - \Delta t(\mathbf{R}^H\U^n)_i.
   %\end{equation}
   %Examining the $i$th equation of the linear system given by Equation \eqref{highD}
   %and solving for $\Delta t b_i$ gives
   %\begin{equation}
      %\Delta t b_i = (\M_C\Delta\U^H)_i
         %+ \Delta t((\mathbf{K}^H + \mathbf{R}^H)\U^n)_i.
   %\end{equation}
   %Substituting this back into Equation \eqref{ex_i_eq} gives
   %\begin{eqnarray}
      %m_i\hat{U}^H_i & = & m_i U^H_i\\
      %\hat{U}^H_i & = & U^H_i
   %\end{eqnarray}
   %Therefore, $\hat{\U}^H = \U^H$.
   %\qed
%\end{proof}
%--------------------------------------------------------------------------------
\subsection{Limiting Coefficients}\label{L}
%================================================================================
\begin{theorem}{Discrete Maximum Principle-Satisfying Limiting Coefficients}
   Suppose that that a discrete maximum principle $W_i^+\le U_i^{n+1}\le W_i^-$
   corresponds to the following inequality for the limited correction fluxes:
   \begin{equation}
      Q_i^-\le\sum\limits_j L_{i,j}F_{i,j}\le Q_i^+,
   \end{equation}
   where $Q_i^\pm$ are bounds that depend on the temporal discretization. Then,
   the following limiter coefficient definitions satisfy the discrete maximum
   principle:
   \begin{equation}\label{P_defs}
      P_i^+ \equiv \sum\limits_j\max(0,F_{i,j}) \qquad
      P_i^- \equiv \sum\limits_j\min(0,F_{i,j}),
   \end{equation}
   \begin{equation}\label{R_defs}
      R_i^\pm \equiv\left\{
         \begin{array}{l l}
            1                                          & P_i^\pm = 0\\
            \min\left(1,\frac{Q_i^\pm}{P_i^\pm}\right) & P_i^\pm \ne 0
         \end{array}
         \right.,
   \end{equation}
   \begin{equation}\label{L_defs}
      L_{i,j} \equiv\left\{
         \begin{array}{l l}
            \min(R_i^+,R_j^-) & F_{i,j} \geq 0\\
            \min(R_i^-,R_j^+) & F_{i,j} < 0
         \end{array}
         \right..
   \end{equation}  
\end{theorem}

\begin{proof}
   First, note some properties of the above definitions:
   \begin{gather*}
      P_i^+ \geq 0, \qquad P_i^- \leq 0,\\
      Q_i^+ \geq 0, \qquad Q_i^- \leq 0,\\
      0 \leq R_i^\pm \leq 1,\\
      0 \leq L_{i,j} \leq 1.
   \end{gather*}
   The proof will be given for the upper bound.
   \[
      \sum\limits_j L_{i,j}F_{i,j}
         \leq \sum\limits_{j:F_{i,j}\geq 0} L_{i,j}F_{i,j}
         = \sum\limits_{j:F_{i,j}\geq 0} \min(R_i^+,R_j^-)F_{i,j}
         \leq \sum\limits_{j:F_{i,j}\geq 0} R_i^+ F_{i,j}
   \]
   For the case $P_i^+ = 0$,
   \[
      \sum\limits_{j:F_{i,j}\geq 0} R_i^+ F_{i,j} = 0 \leq Q_i^+
   \]
   For the case $P_i^+ \ne 0$,
   \[
      \sum\limits_{j:F_{i,j}\geq 0} R_i^+ F_{i,j}
      \leq \sum\limits_{j:F_{i,j}\geq 0}\frac{Q_i^+}{P_i^+} F_{i,j}
      = \frac{Q_i^+}{P_i^+} \sum\limits_{j:F_{i,j}\geq 0} F_{i,j}
      = \frac{Q_i^+}{P_i^+} \sum\limits_{j:F_{i,j}\geq 0} \max(0,F_{i,j})
      = Q_i^+
   \]
   Thus,
   \[
      \sum\limits_j L_{i,j}F_{i,j} \leq Q_i^+
   \]
   The lower bound is proved similarly.
   \qed
\end{proof}
%--------------------------------------------------------------------------------
\subsubsection{Definition of $Q_i^\pm$ for Explicit Euler}
%================================================================================
\begin{theorem}{Discrete Maximum Principle-Satisfying Limited Flux Bounds}
   Using the FCT scheme
   \begin{equation}\label{FCTscheme}
      \M_L\frac{\U^{n+1}-\U^n}{\Delta t}
         + \A^L\U^n
         = \b + \LF \eqc
   \end{equation}
   the following limited flux bounds $Q_i^\pm$ correspond to the discrete
   maximum principle $W_i^+\le U_i^{n+1}\le W_i^-$:
   \begin{equation}\label{Q_ex}
      Q_i^\pm \equiv m_i\frac{W_i^\pm-U_i^n}{\Delta t}
      + \sum\limits_j A_{i,j}^L U_j^n - b_i.
   \end{equation}
\end{theorem}

\begin{proof}
   Starting with row $i$ of Equation \eqref{FCTscheme},
   \[
      m_i\frac{U_i^{n+1}-U_i^n}{\Delta t}
      + \sum\limits_j A_{i,j}^L U_j^n
      = b_i + \sum\limits_jL_{i,j}F_{i,j}.
   \]
   Solving for $\sum\limits_jL_{i,j}F_{i,j}$ gives
   \[
      \sum\limits_jL_{i,j}F_{i,j} =
      m_i\frac{U_i^{n+1}-U_i^n}{\Delta t}
      + \sum\limits_j A_{i,j}^L U_j^n
      - b_i.
   \]
   The discrete maximum principle is
   \[
      W_i^-\le U_i^{n+1}\le W_i^+.
   \]
   Through addition/subtraction and multiplication/division operations, this
   principle can be made to look like the following:
   \[
   m_i\frac{W_i^- -U_i^n}{\Delta t}
      + \sum\limits_j A_{i,j}^L U_j^n
      - b_i
   \le m_i\frac{U_i^{n+1}-U_i^n}{\Delta t}
      + \sum\limits_j A_{i,j}^L U_j^n
      - b_i
   \le m_i\frac{W_i^+ -U_i^n}{\Delta t}
      + \sum\limits_j A_{i,j}^L U_j^n
      - b_i,
   \]
   which by substituting equations above gives
   \[
      Q_i^-\le\sum\limits_j L_{i,j}F_{i,j}\le Q_i^+.\qed
   \]
\end{proof}
%--------------------------------------------------------------------------------
%\begin{lemma}{FCT Scheme Satisfies Discrete Maximum Principle}
   %The definitions given by Equations \ref{P_defs}, \ref{R_defs}, \ref{L_defs},
   %and \ref{ex_bounds} and the following definition yield maximum-principle
   %preserving limiter coefficients:
   %\begin{equation}
      %Q_i^\pm \equiv m_i(W_i^\pm-U_i^n) + \Delta t\sum\limits_j A_{i,j}^L U_j^n
         %- \Delta t b_i,
   %\end{equation}
%\end{lemma}
%
%\begin{proof}
   %The properties given in the proof for Lemma \ref{ss_coef} for $P_i^\pm$,
   %$Q_i^\pm$, $R_i^\pm$, and $L_{i,j}$ hold with these definitions
   %of $W_i^\pm$ and $Q_i^\pm$.
   %The proof will be given for the upper bound. 
   %Taking row $i$ of the linear system given by Equation \eqref{ex_limited} gives
   %\begin{gather*}
      %m_i U_i^{n+1} = m_i U_i^n - \Delta t\sum\limits_j A_{i,j}^L U_j^n + \Delta t b_i
         %+ \sum\limits_j L_{i,j}F_{i,j}\\
      %m_i U_i^{n+1} - m_i U_i^n + \Delta t\sum\limits_j A_{i,j}^L U_j^n - \Delta t b_i
         %= \sum\limits_j L_{i,j}F_{i,j}
   %\end{gather*}
   %As in the proof of Lemma \ref{ss_coef}, the following inequality is found:
   %\[
      %\sum\limits_j L_{i,j}F_{i,j} \leq Q_i^+
   %\]
   %\begin{eqnarray*}
      %m_i U_i^{n+1} - m_i U_i^n + \Delta t\sum\limits_j A_{i,j}^L U_j^n - \Delta t b_i
      %& = & \sum\limits_j L_{i,j}F_{i,j}\\
      %m_i U_i^{n+1} - m_i U_i^n + \Delta t\sum\limits_j A_{i,j}^L U_j^n - \Delta t b_i
      %& \leq & Q_i^+\\
      %m_i U_i^{n+1} - m_i U_i^n + \Delta t\sum\limits_j A_{i,j}^L U_j^n - \Delta t b_i
      %& \leq & m_i(W_i^+-U_i^n) + \Delta t\sum\limits_j A_{i,j}^L U_j^n
         %- \Delta t b_i\\
      %U_i^{n+1} & \leq & W_i^+.
   %\end{eqnarray*}
   %The lower bound is proved similarly.
   %\qed
%\end{proof}
