%================================================================================
\subsection{FCT}
%================================================================================
%================================================================================
\subsubsection{The Explicit System}
%================================================================================
Without strongly imposing Dirichlet boundary conditions, the high-order system is
\begin{equation}
   \mathbf{M}_C\frac{\mathbf{U}^H-\mathbf{U}^n}{\Delta t}
      = -(\mathbf{K}^H+\mathbf{R}^H)\mathbf{U}^n + \mathbf{b},
\end{equation}
\begin{equation}\label{high}
   \mathbf{M}_C\mathbf{U}^H = \mathbf{M}_C\mathbf{U}^n
      - \Delta t(\mathbf{K}^H+\mathbf{R}^H)\mathbf{U}^n + \Delta t\mathbf{b} \equiv \mathbf{b}^H,
\end{equation}
and the corresponding low-order system is
\begin{equation}
   \mathbf{M}_L\frac{\mathbf{U}^L-\mathbf{U}^n}{\Delta t}
      = -(\mathbf{K}^H - \mathbf{D} + \mathbf{R}^L)\mathbf{U}^n + \mathbf{b}.
\end{equation}
\begin{equation}\label{low}
   \mathbf{M}_L\mathbf{U}^L = \mathbf{M}_L\mathbf{U}^n
      - \Delta t(\mathbf{K}^H - \mathbf{D} + \mathbf{R}^L)\mathbf{U}^n + \Delta t\mathbf{b}
      \equiv \mathbf{b}^L.
\end{equation}

After strongly imposing Dirichlet boundary conditions, the linear
systems given by Equations \ref{high} and \ref{low} are modified:
\begin{equation}\label{highD}
   \tilde{\mathbf{M}}_C\mathbf{U}^H = \tilde{\mathbf{b}}^H,
\end{equation}
\begin{equation}\label{lowD}
   \tilde{\mathbf{M}}_L\mathbf{U}^L = \tilde{\mathbf{b}}^L.
\end{equation}
%--------------------------------------------------------------------------------
\subsubsection{Guermond's Flux Correction Algorithm}
%--------------------------------------------------------------------------------
The flux correction vector $\mathbf{f}$ is defined such that:
\begin{equation}\label{fc}
   \mathbf{M}_L\mathbf{U}^H = \mathbf{M}_L\mathbf{U}^L + \mathbf{f} \equiv \mathbf{b}^F,
\end{equation}
Substituting the solutions of Equations \ref{high} and \ref{low} gives the definition
of $\mathbf{f}$:
\begin{equation}\label{Fdef}
   \mathbf{f} \equiv \mathbf{M}_L\mathbf{M}_C^{-1}\mathbf{b}^H
      -\mathbf{M}_L\mathbf{M}_L^{-1}\mathbf{b}^L.
\end{equation}

\begin{lemma}
   Suppose that with strongly imposed Dirichlet boundary conditions, the
   correction step is defined such that the Dirichlet boundary conditions
   are strongly imposed on Equation \ref{fc}:
   \begin{equation}\label{fcD}
      \tilde{\mathbf{M}}_L\hat{\mathbf{U}}^H = \tilde{\mathbf{b}}^F,
   \end{equation}
   and the definition for the flux correction vector $\mathbf{f}$ from
   Equation \ref{Fdef} is used without modification. Then the solution
   to this correction step, $\hat{\mathbf{U}}^H$, will not yield the
   correct high-order solution $\mathbf{U}^H$ given by Equation \ref{highD}.
\end{lemma}
\begin{proof}
   The solution to Equation \ref{fcD} is
   \begin{equation}
      \hat{U}^H_i = \left\{
      \begin{array}{l l}
         g_i                & i\in\mathcal{D}\\
         \frac{1}{m_i}b^F_i & i\notin\mathcal{D}
      \end{array}
      \right.
   \end{equation}
   For $i\in\mathcal{D}$, $\hat{U}^H_i = U_i^H$ because equivalent Dirichlet
   conditions are imposed on Equation \ref{highD}. For $i\notin\mathcal{D}$,
   \begin{eqnarray}
      \hat{U}^H_i & = & \frac{1}{m_i}b^F_i\\
                  & = & \frac{1}{m_i}(m_i U_i^L + f_i)\qquad\mbox{from Equation \ref{fc}}\\
                  & = & U_i^L + \frac{1}{m_i}f_i\label{uhati}
   \end{eqnarray}
   \begin{eqnarray}
      f_i & = & (\mathbf{M}_L\mathbf{M}_C^{-1}\mathbf{b}^H)_i - b^L_i
         \qquad\mbox{from Equation \ref{Fdef}}\\
          & = & m_i(\mathbf{M}_C^{-1}\mathbf{b}^H)_i - b^L_i
   \end{eqnarray}
   Substituting into Equation \ref{uhati} gives
   \begin{eqnarray}
      \hat{U}^H_i & = & U_i^L + \frac{1}{m_i}(m_i(\mathbf{M}_C^{-1}\mathbf{b}^H)_i - b^L_i)\\
                  & = & U_i^L + (\mathbf{M}_C^{-1}\mathbf{b}^H)_i - \frac{1}{m_i}b^L_i.
   \end{eqnarray}
   Recognizing from Equation \ref{lowD} that $U_i^L = \frac{1}{m_i}b^L_i$ finally gives
   \begin{equation}
      \hat{U}^H_i = (\mathbf{M}_C^{-1}\mathbf{b}^H)_i\qquad i\notin\mathcal{D}.
   \end{equation}
   This can be recognized as the solution of Equation \ref{high}, which is not the
   solution to Equation \ref{highD}. Therefore the solution using this correction will yield
   the solution of the high-order system without Dirichlet boundary conditions strongly
   imposed, except at the Dirichlet nodes, where the solution will be forced to the
   Dirichlet values.
   \qed
\end{proof}
%--------------------------------------------------------------------------------
\subsubsection{Kuzmin's Flux Correction Algorithm}
%--------------------------------------------------------------------------------
The flux correction vector $\mathbf{f}$ is defined such that:
\begin{equation}\label{ex_kuzminfc}
   \mathbf{M}_L\mathbf{U}^H
      = (\mathbf{M}_L - \Delta t(\mathbf{K}^H - \mathbf{D} + \mathbf{R}^L))\mathbf{U}^n
         + \Delta t\mathbf{b} + \mathbf{f} \equiv \mathbf{b}^F,
\end{equation}
Subtracting Equation \ref{high} from \ref{ex_kuzminfc} gives the definition of
$\mathbf{f}$:
\begin{equation}\label{ex_kuzminFdef}
   \mathbf{f} \equiv -(\mathbf{M}_C-\mathbf{M}_L)\Delta\mathbf{U}^H
      -\Delta t\mathbf{D}\mathbf{U}^n - \Delta t(\mathbf{R}^H-\mathbf{R}^L)\mathbf{U}^n,
\end{equation}
where $\Delta\mathbf{U}^H = \mathbf{U}^H - \mathbf{U}^n$. Since
$\mathbf{M}_C-\mathbf{M}_L$ and $\mathbf{D}$ are symmetric
and feature zero row and column sums, a valid decomposition for $\mathbf{f}$,
called $\mathbf{F}$, is
\begin{equation}
   F_{i,j} = -m_{i,j}(\Delta U^H_j - \Delta U^H_i) - \Delta t D_{i,j}(U^n_j - U^n_i)
   - \Delta R_{i,j}^H(U^n_j - U^n_i)
\end{equation}
where $m_{i,j}$ is the $i,j$th element of the consistent mass matrix.
Applying a limiter to Equation \ref{ex_kuzminfc} gives
\begin{equation}\label{ex_limited}
   \mathbf{M}_L\mathbf{U}^{n+1}
      = (\mathbf{M}_L - \Delta t(\mathbf{K}^H - \mathbf{D} + \mathbf{R}^L))\mathbf{U}^n
         + \Delta t\mathbf{b} + \mathcal{L}[\mathbf{F}],
\end{equation}
where $(\mathcal{L}[\mathbf{F}])_i = \mathcal{L}_{i,:}F_{i,:}^T
= \sum\limits_j \mathcal{L}_{i,j}F_{i,j}$ and $\mathbf{U}^{n+1}$ is the FCT solution.

\begin{lemma}
   Suppose that with strongly imposed Dirichlet boundary conditions, the
   correction step is defined such that the Dirichlet boundary conditions
   are strongly imposed on Equation \ref{ex_kuzminfc}:
   \begin{equation}\label{ex_kuzminfcD}
      \tilde{\mathbf{M}}_L\hat{\mathbf{U}}^H
         = \tilde{\mathbf{b}}^F,
   \end{equation}
   and the definition for
   the flux correction vector $\mathbf{f}$ from
   Equation \ref{ex_kuzminFdef} is used without modification. Then the solution
   to this correction step, $\hat{\mathbf{U}}^H$, will yield the
   correct high-order solution $\mathbf{U}^H$ given by Equation \ref{highD}.
\end{lemma}
\begin{proof}
   For $i\in\mathcal{D}$, $\hat{U}^H_i = U^H_i = g_i$. For $i\notin\mathcal{D}$,
   we take the $i$th equation of the linear system given by Equation \ref{ex_kuzminfcD}:
   \begin{equation}\label{ex_i_eq}
      m_i\hat{U}^H_i
         = m_i U^n_i - \Delta t((\mathbf{K}^H - \mathbf{D} + \mathbf{R}^L)\mathbf{U}^n)_i
         + \Delta t b_i - (\mathbf{M}_C\Delta\mathbf{U}^H)_i
         + m_i(U^H_i-U^n_i) - \Delta t(\mathbf{D}\mathbf{U}^n)_i - \Delta t(\mathbf{R}^H\mathbf{U}^n)_i.
   \end{equation}
   Examining the $i$th equation of the linear system given by Equation \ref{highD}
   and solving for $\Delta t b_i$ gives
   \begin{equation}
      \Delta t b_i = (\mathbf{M}_C\Delta\mathbf{U}^H)_i
         + \Delta t((\mathbf{K}^H + \mathbf{R}^H)\mathbf{U}^n)_i.
   \end{equation}
   Substituting this back into Equation \ref{ex_i_eq} gives
   \begin{eqnarray}
      m_i\hat{U}^H_i & = & m_i U^H_i\\
      \hat{U}^H_i & = & U^H_i
   \end{eqnarray}
   Therefore, $\hat{\mathbf{U}}^H = \mathbf{U}^H$.
   \qed
\end{proof}
%================================================================================
\subsubsection{Deriving the Limiting Coefficients}
%================================================================================
\begin{lemma}
   The definitions given by Equations \ref{P_defs}, \ref{R_defs}, \ref{L_defs},
   and \ref{ex_bounds} and the following definition yield maximum-principle
   preserving limiter coefficients:
   \begin{equation}
      Q_i^\pm \equiv m_i(W_i^\pm-U_i^n) + \Delta t\sum\limits_j A_{i,j}^L U_j^n
         - \Delta t b_i,
   \end{equation}
\end{lemma}

\begin{proof}
   The properties given in the proof for Lemma \ref{ss_coef} for $P_i^\pm$,
   $Q_i^\pm$, $R_i^\pm$, and $\mathcal{L}_{i,j}$ hold with these definitions
   of $W_i^\pm$ and $Q_i^\pm$.
   The proof will be given for the upper bound. 
   Taking row $i$ of the linear system given by Equation \ref{ex_limited} gives
   \begin{gather*}
      m_i U_i^{n+1} = m_i U_i^n - \Delta t\sum\limits_j A_{i,j}^L U_j^n + \Delta t b_i
         + \sum\limits_j \mathcal{L}_{i,j}F_{i,j}\\
      m_i U_i^{n+1} - m_i U_i^n + \Delta t\sum\limits_j A_{i,j}^L U_j^n - \Delta t b_i
         = \sum\limits_j \mathcal{L}_{i,j}F_{i,j}
   \end{gather*}
   As in the proof of Lemma \ref{ss_coef}, the following inequality is found:
   \[
      \sum\limits_j \mathcal{L}_{i,j}F_{i,j} \leq Q_i^+
   \]
   \begin{eqnarray*}
      m_i U_i^{n+1} - m_i U_i^n + \Delta t\sum\limits_j A_{i,j}^L U_j^n - \Delta t b_i
      & = & \sum\limits_j \mathcal{L}_{i,j}F_{i,j}\\
      m_i U_i^{n+1} - m_i U_i^n + \Delta t\sum\limits_j A_{i,j}^L U_j^n - \Delta t b_i
      & \leq & Q_i^+\\
      m_i U_i^{n+1} - m_i U_i^n + \Delta t\sum\limits_j A_{i,j}^L U_j^n - \Delta t b_i
      & \leq & m_i(W_i^+-U_i^n) + \Delta t\sum\limits_j A_{i,j}^L U_j^n
         - \Delta t b_i\\
      U_i^{n+1} & \leq & W_i^+.
   \end{eqnarray*}
   The lower bound is proved similarly.
   \qed
\end{proof}