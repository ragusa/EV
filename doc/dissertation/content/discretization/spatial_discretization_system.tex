This section gives the spatial discretization for conservation law systems.
Again, CGFEM is used for
spatial discretization, so the numerical solution (now vector-valued:
$\approximatevectorsolution$) is again approximated using an expansion of basis
functions. However, since there are now multiple degrees of freedom at each
node, some discussion on notation is given here to distinguish between node
indexing and degree of freedom indexing.  First, let the number of
\emph{scalar} solution components be denoted by $\ncomponents$.  Thus, as an
example, the 2-D shallow water equations, which consist of a continuity
equation and a conservation of momentum equation, have $\ncomponents=3$ because
the multi-dimensional conservation of momentum equation is comprised of two
scalar conservation of momentum equations.  There are a number of ways to view
the basis function expansion of the approximate solution. For example, one may
use vector-valued basis functions:
\begin{equation}
  \approximatevectorsolution\xt = \sum\limits_{j=1}^{\ndofs}
    \solutionletter_j(\timevalue)\vectortestfunction_j(\x) \eqc
\end{equation}
where the coefficients $\solutionletter_j(\timevalue)$ are the basis function
expansion coefficients at time $\timevalue$, and $\vectortestfunction_j(\x)$
are the vector-valued basis functions
\begin{equation}
  \vectortestfunction_j(\x) = 
    \unitvector{\componentindex(j)}
      \testfunction^{\componentindex(j)}_{\nodeindex(j)}(\x)
  \eqc
\end{equation}
where $\unitvector{\componentindex(j)}$ is the unit vector for dimension
$\componentindex(j)$, $\componentindex(j)$ returns the component index associated with degree
of freedom $j$, and $\nodeindex(j)$ returns the node index associated with
degree of freedom $j$. The basis function $\vectortestfunction_j$ is thus
zero for all components except the one corresponding to $j$ which uses
the scalar component basis function corresponding to component $\componentindex(j)$ of
the solution at node $\nodeindex(j)$.
Alternately, one may view each solution component as its own expansion:
\begin{equation}
  \approximatescalarsolution^m\xt = \sum\limits_{k=1}^{\nnodes}
    \solutionletter_{\dofindex(k,m)}(\timevalue)\testfunction^m_k(\x)
  \eqc
\end{equation}
where $\dofindex(k,m)$ is the global degree of freedom index associated
with node $k$ and solution component $m$.
As opposed to the scalar conservation law case, the vector case interpolates
the conservation law flux between nodal values:
\begin{equation}
  \consfluxvector(\vectorsolution\xt) \rightarrow
  \Pi\consfluxvector(\vectorsolution\xt) 
    \equiv \sumj\vectortestfunction_j(\x)\mathbf{\consfluxletter}
      (\vectorsolution(\x_{\nodeindex(j)},\timevalue))
  \eqc
\end{equation}
where hereafter the nodal flux values used as interpolation values,
$\mathbf{\consfluxletter}(\vectorsolution(\x_{\nodeindex(j)},\timevalue))$,
will be denoted as $\consfluxinterpolant_j(\timevalue)$.
Substituting the approximate
solution into Equation \eqref{eq:conservation_law_system_homo} and testing with basis
function $\vectortestfunction_i(\x)$ gives
\begin{equation}\label{eq:vector_weak_form_long}
   \sumj\intSij\vectortestfunction_i\transpose(\x)\vectortestfunction_j(\x) d\volume
     \ddt{\solutionletter_j}
     + \sumj\intSij\vectortestfunction_i\transpose(\x)\nabla\vectortestfunction_j(\x)
     d\volume\cdot\consfluxinterpolant_j(\timevalue) = \mathbf{0} \eqp
\end{equation}
Again, a mass matrix $\consistentmassmatrix$ is defined:
\begin{equation}
  \consistentmassentry \equiv
    \intSij\vectortestfunction_i\transpose(\x)\vectortestfunction_j(\x) d\volume
\end{equation}
as well a 3rd-order tensor $\gradientmatrix$, which will here be viewed as a
matrix with vector entries:
\begin{equation}
  \gradiententry =
    \intSij\vectortestfunction_i\transpose(\x)
      \nabla\vectortestfunction_j(\x) d\volume
  \eqp
\end{equation}
Making these substitutions into Equation \eqref{eq:vector_weak_form_long} gives
\begin{equation}\label{eq:vector_weak_form}
   \sumj\consistentmassentry\ddt{\solutionletter_j}
     + \sumj\gradiententry\cdot\consfluxinterpolant_j(\timevalue)
     = \mathbf{0} \eqc
\end{equation}
and expressing this as a system gives
\begin{equation}
  \consistentmassmatrix\ddt{\solutionvector}
    + \gradientmatrix\consfluxinterpolant(\timevalue) = \mathbf{0}
  \eqp
\end{equation}
where $\consfluxinterpolant(\timevalue)$ is the vector of nodal flux interpolant values
$\consfluxinterpolant_j(\timevalue)$.
