%================================================================================
\section{Nonlinear Solution}
%================================================================================
The nonlinear systems considered in this research can be written in a quasilinear
form:
\begin{equation}\label{eq:nonlinear_equation}
  \nonlinearmatrix(\solutionvector)\solutionvector
    = \nonlinearrhs(\solutionvector) \eqp
\end{equation}
The right-hand-side $\nonlinearrhs(\solutionvector)$ is a function of
the solution for FCT schemes since in general the limiting coefficients are
functions of the solution.
A system in which Dirichlet boundary conditions are strongly imposed
requires modification of the matrix and right-hand-side vector:
$\nonlinearmatrix\rightarrow\dirichlet{\nonlinearmatrix}$ and
$\nonlinearrhs\rightarrow\dirichlet{\nonlinearrhs}$. In the remainder of
this section, the Dirichlet-modified notation is used to be general;
if strong Dirichlet boundary conditions are not applied, then the
Dirichlet-modified notation can simply be ignored. Subsequent sections
will define the matrix $\nonlinearmatrix$ and $\nonlinearrhs$ for different
nonlinear schemes.

To solve this system, fixed point iteration will be used:
\begin{equation}
  \dirichlet{\nonlinearmatrix}^{(\ell)}\solutionvector^{(\ell+1)}
    = \dirichlet{\nonlinearrhs}^{(\ell)} \eqc
\end{equation}
where $\nonlinearmatrix^{(\ell)}\equiv\nonlinearmatrix(\solutionvector^{(\ell)})$
and $\nonlinearrhs^{(\ell)}\equiv\nonlinearrhs(\solutionvector^{(\ell)})$.
However, in implementation, this will be expressed as a defect correction scheme:
\begin{equation}
  \ssres^{(\ell)} = \dirichlet{\nonlinearrhs}^{(\ell)}
    - \dirichlet{\nonlinearmatrix}^{(\ell)}\solutionvector^{(\ell)} \eqc
\end{equation}
\begin{equation}
  \dirichlet{\nonlinearmatrix}^{(\ell)}\Delta\solutionvector^{(\ell+1)}
    = \ssres^{(\ell)} \eqc
\end{equation}
\begin{equation}
  \solutionvector^{(\ell+1)} = \solutionvector^{(\ell)}
    + \Delta\solutionvector^{(\ell+1)} \eqp
\end{equation}
There are a number of advantages to this approach. Firstly this approach uses
the linear residual $\ssres^{(\ell)}$, which is advantageous when checking
for convergence; for example, there are a number of caveats associated with
checking convergence based on some measure of the difference between solution
iterates $\solutionvector^{(\ell)}$ and $\solutionvector^{(\ell+1)}$.

Another advantage of the defect correction approach is the ease in implementing
a relaxation parameter $\relaxationparameter$:
\begin{equation}
  \solutionvector^{(\ell+1)} = \solutionvector^{(\ell)}
    + \relaxationparameter\Delta\solutionvector^{(\ell+1)} \eqp
\end{equation}

The pseudocode for this defect correction scheme is given in Algorithm
\ref{alg:defect_correction}.
The notation $\|\ssres\|_X$ denotes some norm $X$ of $\ssres$.
The initial guess is denoted by $\solutionvector^{\text{guess}}$. For
transient calculations, the previous time step solution $\solutionvector^n$
is often used as the guess, and for steady-state calculations, one
could use a zero vector as the initial guess.

\begin{algorithm}[H]
\caption{Defect Correction Algorithm}
\label{alg:defect_correction}
\begin{algorithmic}
\State $\solutionvector^{(0)} = \solutionvector^{\text{guess}}$
\State \texttt{converged} $\gets$ \texttt{FALSE}
\For{$\ell\gets 0, \ell_{\text{max}}$}
  \State $\nonlinearmatrix^{(\ell)} \gets
    \nonlinearmatrix(\solutionvector^{(\ell)})$
  \State $\nonlinearrhs^{(\ell)} \gets
    \nonlinearrhs(\solutionvector^{(\ell)})$
  \State $\nonlinearmatrix^{(\ell)} \rightarrow \dirichlet{\nonlinearmatrix}^{(\ell)}$,
    $\nonlinearrhs^{(\ell)} \rightarrow \dirichlet{\nonlinearrhs}^{(\ell)}$,
  \State $\ssres^{(\ell)} \gets \dirichlet{\nonlinearrhs}
    - \dirichlet{\nonlinearmatrix}^{(\ell)}\solutionvector^{(\ell)}$
  \If{$\|\ssres^{(\ell)}\|_X < \nonlineartolerance$}
    \State \texttt{converged} $\gets$ \texttt{TRUE}
    \Break
  \EndIf
  \State $\Delta\solutionvector^{(\ell+1)}
    = \sq{\dirichlet{\nonlinearmatrix}^{(\ell)}}^{-1}\ssres^{(\ell)}$
  \State $\solutionvector^{(\ell+1)} = \solutionvector^{(\ell)}
    + \relaxationparameter\Delta\solutionvector^{(\ell+1)}$
\EndFor
\If{\Not \texttt{converged}}
  \Error{Solution did not converge within $\ell_{\text{max}}$ iterations}
\EndIf
\end{algorithmic}
\end{algorithm}

Table \ref{tab:nonlinear_systems} gives the definitions of the system matrix
and right-hand-side vector given by Equation \eqref{eq:nonlinear_equation}
for a number of different nonlinear schemes. These schemes include schemes
that use entropy viscosity and those that use FCT. For the equations of
transient schemes, the time index superscript $n+1$ as in $\solutionvector^{n+1}$
is understood for $\solutionvector$ with a superscript; this is to be consistent
with the convention that $\solutionvector$ is the vector iterated upon in
the nonlinear scheme.

%-------------------------------------------------------------------------------
\begin{table}[htb]\caption{Nonlinear System Matrix and Right-hand-side Vector for
  Different Schemes}
\label{tab:nonlinear_systems}
\centering
\begin{tabular}{l c}\toprule
\multicolumn{2}{l}{\emph{Steady-State Entropy Viscosity Scheme}}\\\midrule
Equation &
  \(\displaystyle
    \highorderssmatrix(\solutionvector)\solutionvector = \ssrhs\)\\
Matrix &
  \(\displaystyle
    \nonlinearmatrix(\solutionvector)
      \equiv \highorderssmatrix(\solutionvector)\)\\
Right-hand-side &
  \(\displaystyle \nonlinearrhs \equiv \ssrhs\)\\
\midrule
\multicolumn{2}{l}{\emph{Steady-State FCT Scheme}}\\\midrule
Equation &
  \(\displaystyle
    \loworderssmatrix\solutionvector = \ssrhs
    + \limitermatrix(\solutionvector)\cdot\correctionfluxmatrix\)\\
Matrix &
  \(\displaystyle
    \nonlinearmatrix \equiv \loworderssmatrix\)\\
Right-hand-side &
  \(\displaystyle
    \nonlinearrhs(\solutionvector) \equiv \ssrhs
    + \limitermatrix(\solutionvector)\cdot\correctionfluxmatrix\)\\
\midrule
\multicolumn{2}{l}{\emph{Theta Entropy Viscosity Scheme}}\\\midrule
Equation &
  \(\displaystyle
    \consistentmassmatrix\frac{\solutionvector-\solutionvector^n}{\dt}
    + (1-\theta)\ssmatrix^{H,n}\solutionvector^n
    + \theta\ssmatrix^{H}(\solutionvector)\solutionvector
    = (1-\theta)\ssrhs^n + \theta\ssrhs^{n+1}\)\\
Matrix &
  \(\displaystyle
    \nonlinearmatrix(\solutionvector) \equiv \consistentmassmatrix
    + \theta\dt\ssmatrix^H(\solutionvector)\)\\
Right-hand-side &
  \(\displaystyle
    \nonlinearrhs \equiv
      \consistentmassmatrix\solutionvector^n
      - (1-\theta)\dt\ssmatrix^{H,n}\solutionvector^n
      + (1-\theta)\dt\ssrhs^n + \theta\dt\ssrhs^{n+1}\)\\
\midrule
\multicolumn{2}{l}{\emph{Theta FCT Scheme}}\\\midrule
Equation &
  \(\displaystyle
    \lumpedmassmatrix\frac{\solutionvector-\solutionvector^n}{\dt}
    + (1-\theta)\loworderssmatrix\solutionvector^{n}
    + \theta\loworderssmatrix\solutionvector
    = (1-\theta)\ssrhs^n + \theta\ssrhs^{n+1}
    + \limitermatrix(\solutionvector)\cdot\correctionfluxmatrix\)\\
Matrix &
  \(\displaystyle
    \nonlinearmatrix \equiv \lumpedmassmatrix
    + \theta\dt\loworderssmatrix\)\\
Right-hand-side &
  \(\displaystyle
    \nonlinearrhs(\solutionvector) \equiv
      \lumpedmassmatrix\solutionvector^n
      - (1-\theta)\dt\loworderssmatrix\solutionvector^n
      + (1-\theta)\dt\ssrhs^n + \theta\dt\ssrhs^{n+1}
      + \dt\limitermatrix(\solutionvector)\cdot\correctionfluxmatrix\)\\
\bottomrule\end{tabular}
\end{table}
%-------------------------------------------------------------------------------

